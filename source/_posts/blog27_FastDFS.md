---
title: FastDFS
---

### 分布式文件管理系统
* 作用：
	* 通过网络将单机上的文件系统组成一个网络文件系统。
	* 可以快速扩容存储，提高文件访问速度。
	* 主要应用在大型互联网项目中，实现图片存储、音视频存储等服务。
* 服务端
	* 主：元信息(文件名称、大小、分块信息等)
	* 从：文件分块
* 客户端
	* 查询: 从主服务器获取文件元信息，通过元信息操作从服务器，进而获取文件
	* 修改：更新主服务器的元信息，由服务端自动实现对文件的分块存储
通用分布式文件管理系统：
	* NFS、GFS、HDFSC
分布式文件服务提供商(Object Storage Service) OSS：
	* 阿里云、七牛云

### 专用分布式文件管理系统 -- FastDFS
* 使用场景：多用于存储小文件，存储不分块，减少文件拆分、合并造成的额外开销
* 角色：
	* Tracker server  
		* 可以将tracker称为追踪服务器或调度服务器。
		* 负责负载均衡和调度，通过Tracker server在文件上传时可以根据一些策略找到Storage server提供文件上传服务。
		* 存在多个Tracker server组件集群时，各个服务实例平等对外提供服务，客户端采用轮询的方式调用集群中的服务实例。
		* 客户端请求Tracker服务时，不是由tracker直接操作storage完成文件的上传。
		* 而是由tracker告诉客户端一个可用的storage服务的ip和端口，由客户端自己请求storage服务，完成对文件的操作
		* 客户端操作storage服务完成文件上传后，storage向客户端响应file_id，该file_id用于以后访问该文件(文件id即路径(组名/虚拟磁盘路径/数据两级目录/文件名))
		
	* Storage server
		* 作用是文件存储，客户端上传的文件最终存储在Storage服务器上，Storage server没有实现自己的文件系统，而是使用操作系统的文件系统来管理文件。
		* storage集群由一个或多个组构成，一个组由一台或多台存储服务器组成，集群存储总容量为集群中所有组的存储容量之和。
		* 组内的Storage server之间是平等关系，不同组的Storage server之间不会相互通信，
		* 同组内的Storage server之间会相互连接进行文件同步，从而保证同组内每个storage上的文件完全一致的。
		* 一个组的存储容量为该组内的存储服务器容量最小的那个，因此组内存储服务器的软硬件配置最好一致。	
			* 用分组存储方式的好处是灵活、可控性较强。
			* 上传文件时，可以由客户端直接指定上传到的组也可以由tracker进行调度选择。
			* 一个分组的存储服务器访问压力较大时，可以在该组增加存储服务器来扩充服务能力（纵向扩容）。
			* 当系统容量不足时，可以增加组来扩充存储容量（横向扩容）		
		* Storage server会连接集群中所有的Tracker server，定时报告自己的状态，包括磁盘剩余空间、文件同步状况、文件上传下载次数等统计信息。
* 文件上传流程
![文件上传流程](https://s2.ax1x.com/2019/09/08/nGGKYt.jpg)
* 文件下载流程
![文件下载流程](https://s2.ax1x.com/2019/09/08/nGGYwj.jpg)

### 安装
* Tracker安装
	* 施工中...
* Storage安装
	* 施工中...
* FastDFS-Nginx-module：
	* 在storage server上安装nginx的目的是对外通过http访问storage server上的文件。
	* 使用nginx的模块FastDFS-nginx-module的作用是通过http方式访问storage中的文件，当storage本机没有要找的文件时向源storage主机代理请求文件